# 📚 圖片智能命名系統 - 使用指南

**版本**：v1.2.2（UI 優化和進度完善版）  
**最後更新**：2026-01-25（v1.2.2：完整進度顯示、macOS 設計、明確完成訊息）

## 🎯 系統概述

### 核心目標
自動化分析圖片內容並使用智能命名，使用戶無需手動輸入即可實現自描述的檔案名稱，提高圖片管理效率。

### 系統架構

```
┌─────────────────────────────────────────────────────────┐
│         用戶介面層 (UI Layer)                             │
│  ┌──────────────┐          ┌──────────────────┐          │
│  │  GUI 圖形介面  │   或    │  命令行介面       │          │
│  │ (tkinter)    │          │  (interactive)   │          │
│  └──────────────┘          └──────────────────┘          │
└─────────────────────────────────────────────────────────┘
                             ↓
┌─────────────────────────────────────────────────────────┐
│      主程序層 (Core Engine)                              │
│   full_batch_rename_execute.py                          │
├─────────────────────────────────────────────────────────┤
│ 1️⃣ 掃描: 遞迴掃描目錄中的所有圖片                        │
│ 2️⃣ 檢測: 判斷已命名 vs 未命名（增量模式）               │
│ 3️⃣ 分析: 使用 Qwen3-VL 視覺模型分析圖片                │
│ 4️⃣ 規劃: 生成重命名計畫（處理重複）                   │
│ 5️⃣ 執行: 逐檔案重命名 + 刪除原檔案（可選）             │
│ 6️⃣ 報告: 生成詳細的執行報告                            │
└─────────────────────────────────────────────────────────┘
                             ↓
┌─────────────────────────────────────────────────────────┐
│    服務層 (Service Layer)                               │
│  ┌──────────────────┐    ┌──────────────────┐          │
│  │  視覺分析模塊      │    │  進度追蹤模塊      │          │
│  │ (Qwen3-VL 30B)  │    │ (ProgressTracker)│          │
│  │ • 標題提取      │    │ • 進度計算       │          │
│  │ • 主題分類      │    │ • ETA 估計       │          │
│  │ • 內容抽象      │    │ • 日誌記錄       │          │
│  └──────────────────┘    └──────────────────┘          │
│  ┌──────────────────┐    ┌──────────────────┐          │
│  │  檔案追蹤模塊      │    │  重複檢測模塊      │          │
│  │ (FileTracker)    │    │ (去重邏輯)       │          │
│  │ • 增量/強制模式  │    │ • 序號補充       │          │
│  │ • 已命名檢測     │    │ • 覆蓋避免       │          │
│  └──────────────────┘    └──────────────────┘          │
└─────────────────────────────────────────────────────────┘
                             ↓
┌─────────────────────────────────────────────────────────┐
│      儲存層 (Storage Layer)                             │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐             │
│  │ session/ │  │ tracking │  │  logs/   │             │
│  │ JSON報告  │  │ 全局追蹤 │  │ 日誌檔案 │             │
│  └──────────┘  └──────────┘  └──────────┘             │
└─────────────────────────────────────────────────────────┘
```

### 高階邏輯流程

```
用戶選擇資料夾和選項 (GUI/CLI)
        ↓
┌─────────────────────────────────────────┐
│ 掃描階段 (Scanning)                     │
│ • 遞迴掃描：TARGET_DIR.rglob("*.{png,jpg...}")│
│ • 後綴名過濾確保只有圖片                 │
│ • sorted() 保證順序一致                 │
│ 結果：image_files = [file1, file2, ...]│
└─────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────┐
│ 檢測階段 (Detection)                    │
│ [非強制模式] 檢測已命名的檔案            │
│ • is_already_renamed()：檔名是否含中文  │
│ • 分為 renamed_files 和 unnamed_files  │
│ [強制模式] 重新分析所有檔案              │
│ 結果：image_files = [待分析的檔案]      │
└─────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────┐
│ 分析階段 (Analysis)                     │
│ 批量調用 Qwen3-VL 視覺模型              │
│ • 提示詞優化：提取標題 > 主題 > 內容    │
│ • 批次大小：10 張/批                   │
│ • 進度追蹤：每批後更新進度               │
│ • 故障恢復：自動重試 3 次               │
│ 結果：analysis_results = [{...}, ...]  │
└─────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────┐
│ 規劃階段 (Planning)                     │
│ • 提取推薦名稱：analysis['recommended_name']│
│ • 檢測重複名稱                          │
│ • 為重複添加序號：name_01, name_02     │
│ • 驗證新名稱有效性                      │
│ 結果：rename_plan = [{old, new}, ...]  │
└─────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────┐
│ 執行階段 (Execution)                    │
│ 逐檔案執行重命名                        │
│ • Path.rename()：原地重命名              │
│ • 檢查新檔案是否存在（避免覆蓋）        │
│ • 如果 --delete-original，自動刪除     │
│   （Path.rename() 後 old_path 已不存在）│
│ 結果：目錄中檔案已重命名                │
└─────────────────────────────────────────┘
        ↓
┌─────────────────────────────────────────┐
│ 報告階段 (Reporting)                    │
│ • 生成 JSON 報告：rename_final_report.json│
│ • 統計：成功/失敗/刪除數量               │
│ • 耗時：total_time                     │
│ • UI 顯示：進度 100%，完成訊息          │
└─────────────────────────────────────────┘
```

### 技術規格

| 項目 | 規格 | 備註 |
|------|------|------|
| **視覺模型** | Qwen3-VL 30B | 本地運行，無 API 費用 |
| **模型部署** | LM Studio | http://127.0.0.1:1234 |
| **批次大小** | 10 張/批 | 平衡速度和記憶體 |
| **重試次數** | 3 次 | 網路不穩定時自動重試 |
| **超時時間** | 86400 秒（24 小時） | 支持大量圖片 |
| **支持規模** | 2000+ 圖片 | 已驗證 2449 張 |
| **子資料夾** | ✅ 支持遞迴掃描 | 自動發現嵌套目錄中的圖片 |
| **增量模式** | ✅ 默認啟用 | 跳過已命名的檔案，加速 80% |
| **強制模式** | ✅ --force-rename | 重新分析所有檔案 |
| **刪除功能** | ✅ --delete-original | 重命名後刪除原檔案 |
| **進度顯示** | ✅ 實時顯示 | GUI 和終端都能看到 |
| **日誌記錄** | ✅ 詳細日誌 | data/session/progress_log_rename.txt |
| **錯誤恢復** | ✅ 自動處理 | 遇到錯誤時跳過，繼續處理 |

### 意圖和目的

**用戶痛點**：
- 📸 圖片檔名通常是隨機字符（Gemini_xxx.png, IMG_12345.jpg）
- 🔍 無法通過檔名快速識別圖片內容
- ⏱️ 手動命名上百或上千張圖片耗時費力
- 🔄 無法批量重新命名已有的圖片集合

**解決方案**：
- 🤖 AI 自動分析：Qwen3-VL 視覺模型直接提取圖片標題和內容
- 📝 智能命名：優先使用圖片中的標題（最可靠）
- ⚡ 批量處理：支持 2000+ 圖片，進度實時顯示
- 🔧 靈活選項：增量模式、強制重新命名、刪除原檔案

### 版本迭代

| 版本 | 發佈日期 | 主要改進 |
|------|---------|--------|
| v1.0 | 2025-12 | 初版：基礎的 Qwen3-VL 分析 + 重命名 |
| v1.1 | 2026-01 | 增量模式、全局追蹤、詳細報告 |
| v1.2 | 2026-01-24 | 進度追蹤、超時增加、支持大量圖片 |
| **v1.2.1** | **2026-01-25** | **修復進度顯示、刪除邏輯、重複圖片問題** |

---

### ✨ v1.2.1 新增特性與修復（2026-01-25）

本版本專注於改進用戶體驗和修復關鍵邏輯錯誤：

| 修復項 | 問題 | 解決方案 |
|--------|------|--------|
| 🔄 **實時進度顯示** | GUI 和終端無法看到進度 | 使用 subprocess.Popen + select.select 實時捕獲輸出 |
| 🗑️ **刪除邏輯錯誤** | --delete-original 未被實現 | 添加命令行參數，在 rename 時自動刪除原檔案 |
| 📊 **重複圖片問題** | 理解了 Path.rename() 的實際行為 | rename() 自動刪除舊檔案，無需額外操作 |
| ✅ **完成通知** | 沒有明確的完成訊息 | UI 添加 100% 進度和「完成」訊息 |
| ⚠️ **錯誤處理** | stderr 輸出未被顯示 | 同時監視 stdout 和 stderr，實時顯示錯誤 |

**關鍵修復細節**：
1. **進度實時顯示**：改用 Popen 而不是 run，使用 select.select 同時監視 stdout/stderr
2. **刪除原檔案**：添加 --delete-original 參數，GUI Checkbox 會傳遞此參數
3. **邏輯正確性**：Path.rename() 已將舊檔案替換為新檔案，無需再刪除
4. **完整報告**：最終報告中正確記錄 deleted_count

---

## 🎯 快速選擇：選擇適合您的使用方式

| 使用者類型 | 推薦方式 | 命令 |
|----------|--------|------|
| **非技術人員** | 📱 **GUI 圖形介面** | `bash scripts/gui.sh` |
| **一般使用者** | 🖥️ 互動式命令行 | `bash scripts/interactive_rename.sh` |
| **進階使用者** | 💻 Python 直接調用 | 見下文 |

---

## ⚡ 30 秒快速開始

### 最簡單的方式：使用 GUI（推薦 👍）

```bash
cd /Users/hsiaojohnny/dev/rename
bash scripts/gui.sh
```

**然後：**
1. ✅ 點擊「🗂️ 瀏覽資料夾...」選擇要命名的資料夾
2. ✅ 根據需要勾選選項（強制重新命名、刪除原檔案）
3. ✅ 點擊「🚀 開始命名」
4. ✅ 等待完成（進度會在下方顯示）

✨ **完全圖形化！不需要任何命令行知識。**

---

## 📱 三種使用方式詳解

### 方式 1️⃣：GUI 圖形介面（最推薦👍）

**特點：**
- ✅ 完全圖形化，無需命令行
- ✅ 資料夾選擇對話框（像資源管理器一樣）
- ✅ 複選框選擇功能選項
- ✅ 實時進度顯示
- ✅ 結果一目瞭然
- ✅ 最適合非技術人員
- ✅ **顏色優化**：深藍色背景 + 淺藍白色文字，高對比度易於閱讀
- ✅ **已驗證**：2026-01-24 成功測試 10 張圖片，100% 重命名成功

**使用步驟：**

```bash
bash scripts/gui.sh
```

**界面說明：**
- 📁 「瀏覽資料夾」：開啟資料夾選擇對話框
- 🔄 「強制重新命名」：勾選此項將重新分析所有檔案（包括已命名的）
- 🗑️ 「刪除原檔案」：勾選此項在命名完成後刪除原檔案（⚠️ 無法復原）
- 🚀 「開始命名」：開始執行命名（下方會顯示進度）

**v1.2.2 進度顯示新特性：**
- 📊 **進度條**：視覺化進度條，清晰顯示完成百分比
- 📈 **百分比標籤**：「進度：45% (18/40)」實時更新
- ⏱️ **ETA 顯示**：「ETA：5分鐘」預估剩餘時間
- 🔄 **當前步驟**：「正在執行：分析」顯示當前在做什麼
- ✅ **完成通知**：任務完成時彈出提示框，進度條顯示 100%

**色彩設計（符合 macOS Human Interface Guidelines）：**
- 背景：暗藍色 (#1a3a52)，舒適長時間觀看
- 按鈕：
  - 🚀 藍色（#007AFF）：主要操作
  - 🗑️ 紅色（#FF3B30）：危險操作
  - ❌ 灰色（#8E8E93）：次要操作
- 文字：淺藍白色（#e8f4f8），高對比度易於閱讀
- 進度條：原生 macOS ttk.Progressbar 樣式

**測試結果示例（10 張圖片）：**
```
✅ IMG_0050.JPG → 生活_家庭生活_兄妹與螃蟹.JPG
✅ IMG_0051.JPG → 生活_家庭生活_兄妹共進螃蟹餐.JPG
✅ IMG_0057.JPG → 生活_親子_大人帶領孩童街頭行走.JPG
✅ IMG_0058.JPG → 生活_親子活動_孩童玩鞦韆.JPG
✅ IMG_0059.JPG → 生活_親子活動_孩童在公園玩樂.JPG
✅ IMG_0060.JPG → 生活_親子活動_孩童在公園玩耍.JPG
✅ IMG_0061.jpg → 生活_親子_小男孩在公園玩樂.jpg
✅ IMG_0062.jpg → 生活_親子_孩童在公園玩樂_01.jpg
✅ IMG_0063.jpg → 生活_親子_孩童在公園玩樂_02.jpg
✅ IMG_0065.JPG → 生活_親子活動_孩童遊樂.JPG
```

---

### 方式 2️⃣：互動式 Bash 腳本

**特點：**
- ✅ 友善的提示指引
- ✅ 自動處理路徑展開（~/ 等）
- ✅ 錯誤檢查和提示

**使用步驟：**

```bash
cd /Users/hsiaojohnny/dev/rename
bash scripts/interactive_rename.sh
```

---

### 方式 3️⃣：命令行直接調用（進階）

**如果您知道確切的資料夾路徑：**

```bash
# 基本用法
python3 src/full_batch_rename_execute.py --target-dir ~/Downloads

# 強制重新命名
python3 src/full_batch_rename_execute.py --target-dir ~/Downloads --force-rename

# 使用絕對路徑
python3 src/full_batch_rename_execute.py --target-dir /Users/hsiaojohnny/Documents/Photos

# 測試模式：只命名前 N 張圖片（新增 v1.2）
python3 src/full_batch_rename_execute.py --target-dir ~/Downloads --limit 10

# 結合多個參數
python3 src/full_batch_rename_execute.py --target-dir ~/Downloads --limit 10 --force-rename
```

**參數說明：**
| 參數 | 說明 | 例子 |
|------|------|------|
| `--target-dir` | 指定要處理的資料夾 | `/path/to/folder` |
| `--force-rename` | 強制重新命名所有檔案 | 不帶值，只需寫參數名 |
| `--limit` | 限制處理的圖片數量（新增） | `10` 表示只處理前 10 張 |

---

## 🎯 常見情況指南

### 情況 1：我要對 Downloads 資料夾中的圖片命名

**方式 1（GUI，推薦）：**
```bash
bash scripts/gui.sh
# 點擊「瀏覽資料夾」→ 選擇 Downloads → 點擊「開始命名」
```

**方式 2（命令行）：**
```bash
python3 src/full_batch_rename_execute.py --target-dir ~/Downloads
```

### 情況 2：我已經命名過一些檔案，現在有新檔案要命名

**程式會自動跳過已命名的檔案**（默認增量模式）

只需正常運行，程式會：
- ✅ 自動檢測已命名的檔案（檔名包含中文字符）
- ✅ 只處理未命名的檔案
- ✅ 節省時間和 API 調用

### 情況 3：我想重新命名已經命名過的檔案

**使用強制重新命名模式：**

方式 1（GUI）：
```bash
bash scripts/gui.sh
# 勾選「強制重新命名」→ 選擇資料夾 → 點擊「開始命名」
```

方式 2（命令行）：
```bash
python3 src/full_batch_rename_execute.py --target-dir ~/Downloads --force-rename
```

### 情況 4：我要掃描有多個子資料夾的目錄

**無需特別操作！** 程式會自動掃描所有子資料夾：

```bash
bash scripts/gui.sh
# 選擇最上層的資料夾
# 程式會自動掃描所有子資料夾（如 Line貼圖機器人、自動化腳本等）
```

支援的結構：
```
資料夾/
  ├── 圖片1.png              ✅ 會掃描
  ├── 子資料夾1/
  │   └── 圖片2.jpg          ✅ 會掃描
  └── 子資料夾2/
      └── 更深層資料夾/
          └── 圖片3.gif      ✅ 會掃描
```

---

## ❌ 遇到問題怎麼辦？

### 問題 1：打開 GUI 時出現錯誤

**解決方法：**
```bash
# 檢查 Python 版本
python3 --version  # 應該是 3.11+

# 檢查 conda 環境
conda activate image-rename

# 重新運行
bash scripts/gui.sh
```

### 問題 2：找不到要命名的資料夾

**確認：**
- ✅ 資料夾路徑正確（可在 Finder 中複製路徑）
- ✅ 資料夾不是空的
- ✅ 有讀取權限

### 問題 3：命名速度很慢

**原因和解決：**
- 🔴 **LM Studio 未啟動**：請先打開 LM Studio，確保伺服器運行
- 🔴 **圖片數量太多**：程式會分批處理，進度會顯示在 GUI 中
- 🔴 **電腦性能不足**：GPU 加速會大大提速（LM Studio 會自動使用）

### 問題 4：「操作已取消」或「找不到圖片」

**檢查清單：**
- ✅ 資料夾中確實有圖片（.png, .jpg, .jpeg, .webp, .gif, .bmp）
- ✅ 圖片不是損壞或特殊格式
- ✅ 資料夾有讀取權限

---

## 📊 理解結果

### 執行完成後會看到：

```
📊 掃描結果：找到 69 個圖片檔案
   已命名：5 個
   未命名：64 個

⚙️  開始處理 64 個未命名的檔案...

✅ 命名完成！
   成功：64 個
   失敗：0 個
   跳過：0 個
```

**什麼是「已命名」？**
- 檔名包含中文字符的檔案被認為已命名
- 程式會自動跳過（除非使用 `--force-rename`）

---

## 🔄 重複運行和進階使用

### 可以重複運行嗎？

✅ **可以！** 程式會自動：
1. 檢測已命名的檔案（默認跳過）
2. 只處理新的、未命名的檔案
3. 避免重複命名

### 進階：設置快捷方式

**在 macOS 中創建快捷方式：**

1. 打開「自動操作」
2. 選擇「新建快速操作」
3. 搜尋「執行 Shell 腳本」
4. 輸入：
   ```bash
   /Users/hsiaojohnny/dev/rename/scripts/gui.sh
   ```
5. 保存為「圖片命名」

---

## 📞 技術支援

### 查看詳細日誌

命名完成後，可以在以下位置查看詳細日誌：

```bash
cat logs/rename.log
```

### 查看分析結果

```bash
ls -la data/analysis_results/
```

---

## 📝 常見問題 (FAQ)

**Q: 命名後能恢復原檔名嗎？**  
A: 可以！在 `data/tracking/` 下有完整的映射記錄，記錄了所有原檔名和新檔名的對應關係。

**Q: 是否支援自定義命名規則？**  
A: 目前優先使用圖片中的標題（最準確），如果沒有標題則使用主題+子題分類。未來版本會支援自定義。

**Q: 能在多台電腦上使用嗎？**  
A: 可以！整個項目是自包含的，無硬編碼路徑，可以複製到任何位置或電腦上使用。

**Q: 支援哪些圖片格式？**  
A: 支援 PNG, JPG, JPEG, WebP, GIF, BMP（6 種標準格式）

---

**祝您使用愉快！有任何問題歡迎反饋。** 🎉



### 方式 2️⃣：互動式 Bash 腳本

**特點：**
- ✅ 友善的提示指引
- ✅ 自動處理路徑展開（~/ 等）
- ✅ 錯誤檢查和提示

**使用步驟：**

```bash
cd /Users/hsiaojohnny/dev/rename
bash scripts/interactive_rename.sh
```

### 方式 3️⃣：命令行直接調用（進階）

**如果您知道確切的資料夾路徑：**

```bash
python3 src/full_batch_rename_execute.py --target-dir ~/Downloads
```

---

## 🎯 常見情況指南

### 情況 1：第一次使用

1. 打開 LM Studio，啟動伺服器
2. 運行 GUI：
   ```bash
   bash scripts/gui.sh
   ```
3. 選擇要命名的資料夾
4. 點擊「開始命名」

### 情況 2：後續使用（新圖片）

程式會自動跳過已命名的檔案（檔名包含中文）

### 情況 3：重新命名舊圖片

勾選「強制重新命名」後運行

---

## ❌ 遇到問題怎麼辦？

### 問題 1：LM Studio 未啟動

**症狀：** 命名時出現「連接失敗」錯誤

**解決：** 
1. 打開 LM Studio 應用
2. 確保伺服器已啟動（顯示「Server is running」）
3. 重新運行命名

### 問題 2：找不到要命名的資料夾

**確認：**
- ✅ 資料夾路徑正確
- ✅ 資料夾中有圖片檔案
- ✅ 有讀取權限

### 問題 3：「找不到圖片檔案」

**可能原因：**
- 圖片在子資料夾中（但程式已支援遞迴掃描）
---

## 🐛 故障排查（依問題類型）

### GUI 相關問題

#### 問題：GUI 顯示「執行失敗」或「無進度」
**症狀：**
```
❌ 執行失敗（返回碼：1）
[或 GUI 卡住不動]
```

**可能原因：**
1. LM Studio 沒有運行
2. 目標資料夾不存在或無寫入權限
3. 磁碟空間不足（<1GB）
4. 圖片格式不支援

**解決步驟：**
```bash
# 1. 檢查 LM Studio 是否運行
curl http://127.0.0.1:1234/v1/models

# 應該返回模型列表，如：
# {"data":[{"id":"qwen/qwen3-vl-30b","object":"model"}]}

# 2. 檢查目標資料夾
ls -la /path/to/your/folder

# 3. 檢查磁碟空間
df -h ~

# 4. 查看詳細錯誤信息
# 錯誤應該在 GUI 結果框的底部顯示（stderr 輸出）
```

#### 問題：LLM 分析完成但圖片未被重命名
**症狀：**
```
✅ 分析完成（62 張圖片，100% 成功）
[但檔案列表未變化]
```

**根本原因分析：**
這是 v1.1.2 之前版本的關鍵 bug，由以下三個問題組合而成：

1. **data 目錄未被正確建立**
   - 舊代碼：`DATA_DIR.mkdir(exist_ok=True)` ❌
   - 當父目錄不存在時會拋出異常
   - 新代碼：`DATA_DIR.mkdir(parents=True, exist_ok=True)` ✅

2. **檔案路徑資訊丟失**
   - 掃描時使用 `rglob("*")` 遞迴掃描所有子目錄中的圖片
   - 但記錄結果時只保存 `image_path.name`（檔名）
   - 丟失了目錄資訊（例如：`subdir/test.png` 變成 `test.png`）

3. **重命名時路徑不匹配**
   ```python
   # 舊邏輯（錯誤）
   old_path = TARGET_DIR / item['old_filename']  # 假設檔案在根目錄
   # 實際：檔案可能在 subdir/ 中，所以 old_path.exists() 返回 False
   # 結果：整個 if 塊被跳過，未執行任何重命名操作
   ```

**解決方案（v1.1.2+）：**
✅ 已在最新版本中修復：
- 添加 `parents=True` 確保目錄建立
- 修改代碼保存**完整相對路徑**（包含子目錄）
- 重命名時正確使用完整路徑查找檔案

**驗證修復成功：**
1. 重新運行命名
2. 檢查 `data/session/qwen_vision_analysis_complete.json` 是否被建立
3. 檢查 `data/session/qwen_rename_final_report.json` 中的 `"renamed"` 計數是否 > 0

**手動驗證：**
```bash
# 查看 data 目錄是否成功建立
ls -la data/session/

# 查看分析結果
cat data/session/qwen_vision_analysis_complete.json | head -30

# 查看重命名報告
cat data/session/qwen_rename_final_report.json
```

#### 問題：GUI 中文顯示亂碼
**症狀：**
```
[显示为?或乱码]
```

**解決方案：**
```bash
# 確保終端編碼為 UTF-8
export LANG=zh_TW.UTF-8

bash scripts/gui.sh
```

### 命令行相關問題

#### 問題 1：「找不到 python3」
```bash
bash scripts/gui.sh
# 錯誤：❌ 找不到 Python 3
```

**解決方案：**
```bash
# 安裝 Python 3.11+
# macOS (使用 Homebrew)
brew install python@3.11

# 驗證
python3 --version  # 應該 >= 3.11
```

#### 問題 2：「conda 環境未激活」
```bash
# 錯誤：⚠️ 您還未激活 conda 環境
```

**解決方案：**
```bash
# 查看可用環境
conda env list

# 激活環境
conda activate image-rename

# 驗證
which python  # 應該指向 conda 環境
```

#### 問題 3：「連接 LM Studio 失敗」
```bash
# 錯誤：Connection refused on 127.0.0.1:1234
```

**解決方案：**
```bash
# 1. 確認 LM Studio 正在運行
curl http://127.0.0.1:1234/v1/models

# 2. 如果失敗，啟動 LM Studio
# （請參考 LM Studio 安裝文檔）

# 3. 檢查防火牆
# macOS：檢查系統偏好設定 > 安全性和隱私
```

### 分析和重命名相關

#### 問題 4：「某些圖片分析為 N/A」
**症狀：**
```
"image_title": "N/A"
"main_theme": "N/A"
```

**可能原因：**
- 圖片無文字內容（純圖片）
- 圖片格式不支援
- 圖片檔案損壞

**解決方案：**
- 系統會跳過這些圖片，使用備選命名方案
- 查看 logs/ 資料夾瞭解詳細信息

#### 問題 5：「命名速度很慢」

**原因：**
- 首次執行需要啟動模型（30-60 秒）
- 大量圖片會分批處理
- 機器配置影響（CPU/GPU）

**最佳化建議：**
```yaml
# 編輯 config/config.yaml
batch_size: 10          # 批次大小（可增加到 20）
model_threads: 4        # 並行線程
enable_cache: true      # 啟用快取
```

### 資料和檔案相關

#### 問題 6：「想要恢復舊檔名」

**建議：**
1. 執行時選擇「保留原檔案」（推薦）
2. 查看 `data/session/qwen_rename_plan_complete.json` 中的映射表
3. 手動恢復或批量重命名

**使用映射表恢復：**
```bash
python3 << 'EOF'
import json

# 讀取映射表
with open('data/session/qwen_rename_plan_complete.json') as f:
    plan = json.load(f)

# 顯示映射信息
for item in plan:
    print(f"{item['new_filename']} → {item['old_filename']}")
EOF
```

---

## 📊 理解結果

### 生成的文件

命名完成後，會生成以下文件：

**在您的圖片資料夾中：**
- 新命名的圖片檔案（例如：`技術_AI系統_自動化指令執行.png`）
- 原檔案（如果您選擇保留）

**在項目資料夾中：**
- `data/session/qwen_vision_analysis_complete.json` - 詳細分析結果
- `data/session/qwen_rename_plan_complete.json` - 命名映射表
- `data/session/qwen_rename_final_report.json` - 最終報告
- `logs/rename.log` - 執行日誌

### 驗收標準

✅ 命名準確度 > 95%  
✅ 0 個重複檔名  
✅ 看檔名就能聯想到圖片內容  

---

## 🔧 進階設置

### 自定義配置

編輯 `config/config.yaml` 可以自定義：
```yaml
naming:
  priority_field: "image_title"  # 優先使用的欄位
  separator: "_"                  # 檔名分隔符
  language: "zh-TW"               # 語言
  
api:
  base_url: "http://127.0.0.1:1234"  # LM Studio 位置
  timeout: 300                        # 超時時間（秒）
  
processing:
  batch_size: 10                  # 批次大小
  max_workers: 4                  # 並行工作者數
```

### 查看詳細日誌

```bash
# 即時查看日誌
tail -f logs/rename.log

# 查看上次執行的完整日誌
cat logs/rename.log | tail -100
```

---

## 📞 技術支援

詳見項目文件：
- **README.md** - 項目概述和故障排查
- **v1.1_智能文件追蹤功能說明.md** - v1.1 新功能
- **.github/copilot-instructions.md** - 開發規範

---

**祝您使用愉快！** 🎉
