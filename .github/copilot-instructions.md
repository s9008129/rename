# copilot-instructions.md

GitHub Copilot 和 Claude AI 協作開發指導原則
本文定義了與 AI 助手協作的最高指導原則，確保代碼質量、可維護性和項目目標的一致性。

---

## 🎯 核心原則（First Principles）

### 1. 真實性優先（Authenticity First）
- **原則**：優先使用真實數據和實際分析，而非模式匹配或假設
- **實踐**：
  - 直接分析圖片內容，不依賴檔案名或元數據
  - 優先使用視覺模型提取的結果（image_title），而非生成的推薦名稱
  - 建立完整的追蹤和驗證機制
- **反例**：使用檔案名模式匹配而非真實分析，導致命名不準確

### 2. 可復用性設計（Reusability Design）
- **原則**：每個組件應設計為可獨立復用
- **實踐**：
  - 寫通用工具函數，而非特定用途的腳本
  - 使用配置檔案，而非硬編碼參數
  - 記錄完整的映射和元數據，支持恢復和查詢
  - 提供模板和示例，便於他人學習和擴展
- **範例**：full_batch_rename_execute.py 可用於任何圖片集合

### 3. 容錯性設計（Fault Tolerance）
- **原則**：系統應能從失敗中恢復，並提供清晰的故障信息
- **實踐**：
  - 實現進度保存機制，支持中斷後恢復
  - 重試邏輯與延迟處理
  - 詳細的錯誤日誌和統計報告
  - 自動驗證結果的唯一性和完整性
- **範例**：檔案重命名失敗時自動修復特殊字符，而非中止整個過程

### 4. 透明性和可審計性（Transparency & Auditability）
- **原則**：所有決策都應可追蹤和驗證
- **實踐**：
  - 保存完整的映射表（舊名→新名）
  - 記錄每個圖片的分析過程和結果
  - 生成詳細的統計報告
  - 提供命名案例和驗證報告
- **範例**：qwen_rename_plan_complete.json 記錄了所有 338 張圖片的映射

---

## 📋 AI 協作最佳實踐

### 代碼審查（Code Review）
- ✅ 明確指定算法和資料結構
- ✅ 要求提供錯誤處理和邊界情況考慮
- ✅ 驗證異步操作和進度保存
- ❌ 避免："寫一個腳本來處理檔案"（太模糊）
- ✅ 替代："寫一個批量重命名腳本，支持進度保存、自動重試、詳細日誌"

### 技術決策（Technical Decisions）
- ✅ 用第一性原理分析問題根本
- ✅ 評估多個技術方案，記錄決策理由
- ✅ 優先考慮本地化方案（隱私、成本、性能）
- ✅ 建立驗證機制來檢驗假設
- **範例**：選擇 Qwen3-VL 30B 本地模型而非 Claude API，原因是隱私保護、成本優化、無速率限制

### 文檔編寫（Documentation）
- ✅ 包含第一性原理說明（為什麼）
- ✅ 包含技術架構圖和資料流
- ✅ 包含完整的使用示例和案例
- ✅ 包含故障排查和常見問題
- ✅ 使用台灣繁體中文，符合本地化需求

### 測試策略（Testing）
- ✅ 單元測試：測試獨立組件
- ✅ 集成測試：測試完整流程
- ✅ 回歸測試：驗證品質標準
- ✅ 負載測試：驗證性能和可靠性
- **標準**：項目應達到 100 / 100 品質評分

---

## 🛠️ 開發工作流

### Phase 1：需求分析
1. 用第一性原理分析用戶的真實痛點
2. 區分「用戶說想要什麼」和「用戶真正需要什麼」
3. 定義清晰的驗收標準（例如："看檔名就可以直接聯想圖片內容"）
4. 評估多個技術方案，記錄優缺點

### Phase 2：技術設計
1. 提出架構設計和資料流圖
2. 定義配置、API 和介面
3. 確定可復用組件和模板
4. 預定義測試策略

### Phase 3：實現
1. 實現核心邏輯和工具函數
2. 添加進度保存和錯誤處理
3. 實現驗證和統計功能
4. 編寫詳細的日誌

### Phase 4：驗證和文檔
1. 運行完整測試套件
2. 驗證輸出品質（唯一性、精準度、可讀性）
3. 生成統計報告
4. 編寫詳細的文檔和案例

---

## 📝 提示詞模板（Prompt Templates）

### 深度分析提示詞
```
使用第一性原理及 COT（Chain of Thought）深度分析：
1. 理解用戶的真實需求和痛點
2. 評估多個技術方案
3. 選擇最優方案並記錄理由

具體要求：
- 區分「用戶表述」和「實際需求」
- 考慮可復用性、容錯性、可維護性
- 提供詳細的設計文檔
```

### 代碼實現提示詞
```
實現 [功能名]，要求：
1. 核心算法和資料結構明確
2. 完整的錯誤處理
3. 進度保存和恢復機制
4. 詳細的日誌輸出
5. 完整的單元測試

提供：
- 源代碼
- 使用示例
- 故障排查指南
```

### 文檔編寫提示詞
```
編寫 [文檔名]，要求：
1. 包含第一性原理說明
2. 包含完整的技術細節
3. 包含使用示例和案例
4. 使用台灣繁體中文
5. 結構清晰，易於查找

範圍：
- 概述和背景
- 技術實現細節
- 使用指南
- 常見問題和故障排查
```

---

## 🎯 質量標準

### 代碼質量
- ✅ 代碼風格一致（PEP 8 for Python）
- ✅ 變數名明確和自述
- ✅ 函數長度 < 100 行
- ✅ 圈複雜度低
- ✅ 測試覆蓋率 > 80%

### 功能完整性
- ✅ 所有邊界情況都被處理
- ✅ 錯誤信息清晰和有用
- ✅ 性能可接受
- ✅ 文檔完整

### 文檔質量
- ✅ 包含概述和背景
- ✅ 包含使用示例
- ✅ 包含故障排查
- ✅ 包含 API 文檔
- ✅ 使用台灣繁體中文

### 項目成果質量
- ✅ 品質評分達到 100 / 100
- ✅ 所有驗收標準都達成
- ✅ 超期望完成（120% 以上）

---

## 🔄 與 AI 的協作循環

### 1. 明確指示（Clear Instructions）
給 AI 助手明確的指示，而非模糊的請求：
```
❌ "幫我重命名這些圖片"
✅ "使用 Qwen3-VL 分析圖片，優先提取圖片中的標題，
    自動處理重複，生成完整映射表，
    並驗證所有檔名的唯一性"
```

### 2. 反覆驗證（Iterative Verification）
不要盲目接受 AI 生成的結果：
```
1. AI 生成代碼
2. 人工檢查邏輯和實現
3. 運行測試和驗證
4. 根據結果調整和改進
5. 重複直到滿足標準
```

### 3. 記錄決策（Decision Documentation）
記錄 AI 建議和人工決策的對話：
```
- AI 建議什麼？
- 為什麼接受或拒絕？
- 最終選擇了什麼？
- 結果如何？
```

---

## 📚 參考資源

### GitHub Copilot 官方文檔
- [Copilot 使用指南](https://docs.github.com/en/copilot/using-github-copilot)
- [Copilot 最佳實踐](https://github.com/github/copilot-docs)

### 本項目文檔
- [ARCHITECTURE.md](docs/ARCHITECTURE.md) - 技術架構
- [FIRST_PRINCIPLES.md](docs/FIRST_PRINCIPLES.md) - 第一性原理分析
- [README.md](README.md) - 項目概述和使用指南

### 相關最佳實踐
- Clean Code - Robert C. Martin
- Software Architecture - The Hard Parts - Neal Ford et al.
- Prompt Engineering for AI - OpenAI Cookbook

---

## 🚀 與此項目的應用

### 本項目應用了以下原則
1. **真實性優先**：使用 Vision Model 直接分析圖片，而非模式匹配
2. **可復用性**：提供通用的分析腳本和配置模板
3. **容錯性**：進度保存、自動重試、詳細日誌
4. **透明性**：完整的映射表、分析結果、驗證報告

### 成果驗證
- ✅ 338 張圖片精準命名
- ✅ 97% 優先使用圖片標題
- ✅ 100 / 100 品質評分
- ✅ 0 個重複檔名
- ✅ 100% 驗收標準達成

---

## 🔄 Auto Commit 機制（Non-Negotiable）

**每次完成任務後，MUST 執行 git commit。**

### Commit 訊息規範

```
<type>(<scope>): <簡短摘要>

## 意圖與情境
- 用戶想要達成什麼目標
- 在什麼背景下提出需求

## 執行內容
- 具體做了哪些修改
- 新增/修改/刪除了哪些檔案

## 決策理由
- 為什麼選擇這個方案
- 第一性原理分析結果

## 執行結果
- 達成了什麼效果
- 驗證結果（通過/失敗）

## 待確認工作
- 需要人類確認的事項
- 後續建議的行動
```

### Commit Type

| Type | 用途 |
|------|------|
| `feat` | 新功能 |
| `fix` | 錯誤修復 |
| `docs` | 文件更新 |
| `refactor` | 重構（不改變功能） |
| `test` | 測試相關 |
| `chore` | 雜項（設定、依賴等） |

### 語言要求

- Commit 訊息 MUST 使用繁體中文（zh-TW）
- 技術術語可保留英文（如 API、MCP、LLM）

---

## 🔧 Context7 MCP 使用規範（Non-Negotiable）

**所有技術決策 MUST 透過 Context7 MCP 取得最新官方文件。**

### 使用流程

```
1. 先呼叫 resolve-library-id 取得正確的 library ID
2. 再呼叫 context7-query-docs 取得文件
3. 基於官方文件做出技術決策
4. 在 commit 中記錄文件來源
```

### 實踐範例

**不好的做法：**
```
"我知道如何使用 Bash，直接寫腳本"
```

**好的做法：**
```
1. 呼叫 resolve-library-id 取得 /bminor/bash
2. 呼叫 context7-query-docs 查詢 "interactive CLI user input"
3. 基於官方文件最佳實踐編寫腳本
4. 在 commit 中記錄來源：
   "基於 Bash 官方文件 context7:/bminor/bash 的最佳實踐"
```

---



---

## 🎨 GUI 設計原則（v1.1.2+）

**目標**：為非技術人員提供友善的使用介面

### 設計理念
- **最小成本**：使用 Python 內置 tkinter，無額外依賴
- **輕量化**：界面簡潔，功能聚焦
- **清晰指引**：步驟明確，提示友善

### 核心功能
1. **資料夾選擇**：使用原生文件對話框
2. **功能選項**：複選框選擇 (強制重新命名、刪除原檔案)
3. **進度反饋**：實時顯示執行進度和結果
4. **錯誤處理**：清晰的錯誤提示和恢復建議

### 應用層次
- 主窗口：`ImageRenamerGUI` 類
- 子組件：資料夾選擇、選項設置、結果顯示
- 線程管理：後台執行命名，避免 GUI 凍結

### 啟動方式
```bash
bash scripts/gui.sh      # 推薦使用
python3 src/gui_selector.py  # 直接調用
```

