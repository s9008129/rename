# copilot-instructions.md

GitHub Copilot 和 Claude AI 協作開發指導原則
本文定義了與 AI 助手協作的最高指導原則，確保代碼質量、可維護性和項目目標的一致性。

---

## 🎯 核心原則（First Principles）

### 1. 真實性優先（Authenticity First）
- **原則**：優先使用真實數據和實際分析，而非模式匹配或假設
- **實踐**：
  - 直接分析圖片內容，不依賴檔案名或元數據
  - 優先使用視覺模型提取的結果（image_title），而非生成的推薦名稱
  - 建立完整的追蹤和驗證機制
- **反例**：使用檔案名模式匹配而非真實分析，導致命名不準確

### 2. 可復用性設計（Reusability Design）
- **原則**：每個組件應設計為可獨立復用
- **實踐**：
  - 寫通用工具函數，而非特定用途的腳本
  - 使用配置檔案，而非硬編碼參數
  - 記錄完整的映射和元數據，支持恢復和查詢
  - 提供模板和示例，便於他人學習和擴展
- **範例**：full_batch_rename_execute.py 可用於任何圖片集合

### 3. 容錯性設計（Fault Tolerance）
- **原則**：系統應能從失敗中恢復，並提供清晰的故障信息
- **實踐**：
  - 實現進度保存機制，支持中斷後恢復
  - 重試邏輯與延迟處理
  - 詳細的錯誤日誌和統計報告
  - 自動驗證結果的唯一性和完整性
- **範例**：檔案重命名失敗時自動修復特殊字符，而非中止整個過程

### 4. 透明性和可審計性（Transparency & Auditability）
- **原則**：所有決策都應可追蹤和驗證
- **實踐**：
  - 保存完整的映射表（舊名→新名）
  - 記錄每個圖片的分析過程和結果
  - 生成詳細的統計報告
  - 提供命名案例和驗證報告
- **範例**：qwen_rename_plan_complete.json 記錄了所有 338 張圖片的映射

---

## 📋 AI 協作最佳實踐

### 代碼審查（Code Review）
- ✅ 明確指定算法和資料結構
- ✅ 要求提供錯誤處理和邊界情況考慮
- ✅ 驗證異步操作和進度保存
- ❌ 避免："寫一個腳本來處理檔案"（太模糊）
- ✅ 替代："寫一個批量重命名腳本，支持進度保存、自動重試、詳細日誌"

### 技術決策（Technical Decisions）
- ✅ 用第一性原理分析問題根本
- ✅ 評估多個技術方案，記錄決策理由
- ✅ 優先考慮本地化方案（隱私、成本、性能）
- ✅ 建立驗證機制來檢驗假設
- **範例**：選擇 Qwen3-VL 30B 本地模型而非 Claude API，原因是隱私保護、成本優化、無速率限制

### 文檔編寫（Documentation）
- ✅ 包含第一性原理說明（為什麼）
- ✅ 包含技術架構圖和資料流
- ✅ 包含完整的使用示例和案例
- ✅ 包含故障排查和常見問題
- ✅ 使用台灣繁體中文，符合本地化需求

### 測試策略（Testing）
- ✅ 單元測試：測試獨立組件
- ✅ 集成測試：測試完整流程
- ✅ 回歸測試：驗證品質標準
- ✅ 負載測試：驗證性能和可靠性
- **標準**：項目應達到 100 / 100 品質評分

---

## 🛠️ 開發工作流

### Phase 1：需求分析
1. 用第一性原理分析用戶的真實痛點
2. 區分「用戶說想要什麼」和「用戶真正需要什麼」
3. 定義清晰的驗收標準（例如："看檔名就可以直接聯想圖片內容"）
4. 評估多個技術方案，記錄優缺點

### Phase 2：技術設計
1. 提出架構設計和資料流圖
2. 定義配置、API 和介面
3. 確定可復用組件和模板
4. 預定義測試策略

### Phase 3：實現
1. 實現核心邏輯和工具函數
2. 添加進度保存和錯誤處理
3. 實現驗證和統計功能
4. 編寫詳細的日誌

### Phase 4：驗證和文檔
1. 運行完整測試套件
2. 驗證輸出品質（唯一性、精準度、可讀性）
3. 生成統計報告
4. 編寫詳細的文檔和案例

---

## 📝 提示詞模板（Prompt Templates）

### 深度分析提示詞
```
使用第一性原理及 COT（Chain of Thought）深度分析：
1. 理解用戶的真實需求和痛點
2. 評估多個技術方案
3. 選擇最優方案並記錄理由

具體要求：
- 區分「用戶表述」和「實際需求」
- 考慮可復用性、容錯性、可維護性
- 提供詳細的設計文檔
```

### 代碼實現提示詞
```
實現 [功能名]，要求：
1. 核心算法和資料結構明確
2. 完整的錯誤處理
3. 進度保存和恢復機制
4. 詳細的日誌輸出
5. 完整的單元測試

提供：
- 源代碼
- 使用示例
- 故障排查指南
```

### 文檔編寫提示詞
```
編寫 [文檔名]，要求：
1. 包含第一性原理說明
2. 包含完整的技術細節
3. 包含使用示例和案例
4. 使用台灣繁體中文
5. 結構清晰，易於查找

範圍：
- 概述和背景
- 技術實現細節
- 使用指南
- 常見問題和故障排查
```

---

## 🎯 質量標準

### 代碼質量
- ✅ 代碼風格一致（PEP 8 for Python）
- ✅ 變數名明確和自述
- ✅ 函數長度 < 100 行
- ✅ 圈複雜度低
- ✅ 測試覆蓋率 > 80%

### 功能完整性
- ✅ 所有邊界情況都被處理
- ✅ 錯誤信息清晰和有用
- ✅ 性能可接受
- ✅ 文檔完整

### 文檔質量
- ✅ 包含概述和背景
- ✅ 包含使用示例
- ✅ 包含故障排查
- ✅ 包含 API 文檔
- ✅ 使用台灣繁體中文

### 項目成果質量
- ✅ 品質評分達到 100 / 100
- ✅ 所有驗收標準都達成
- ✅ 超期望完成（120% 以上）

---

## 🧠 高階邏輯與系統設計原則

### 1. 系統整體目標
```
目標：建立一個精準、自動化、可復用的圖片智能命名系統

核心驅動力：
  用戶痛點 → 圖片檔名不夠描述性，難以快速識別內容
  解決方案 → 優先使用圖片中的標題（直接、精準、無損）
  度量指標 → 100% 唯一性、99.9% 準確率、可復用性
```

### 2. 系統架構邏輯
```
圖片檔案 
  ↓
[視覺分析層] Qwen3-VL 30B（本地化、零成本）
  ↓
[優先級決策] 
  1. image_title（OCR 提取，最優先）
  2. main_theme + core_content（語義分析）
  3. 檔名優化（重複檢測和修復）
  ↓
[執行層] 重命名 + 追蹤 + 報告
  ↓
[驗證層] 唯一性檢查 + 統計報告
```

### 3. 決策邏輯優先級
```
第 1 級：圖片中的標題（image_title）
  └─ 來源：OCR 直接提取
  └─ 優先度：最高
  └─ 準確度：99.9%
  └─ 理由：最可靠、最直接、最不易失真

第 2 級：主題+內容組合（main_theme + core_content）
  └─ 來源：語義分析
  └─ 優先度：中等
  └─ 準確度：95%
  └─ 理由：當無標題時的最佳備選

第 3 級：檔名優化（避免重複和特殊字符）
  └─ 操作：自動檢測和修復
  └─ 優先度：高
  └─ 方法：序號補充、特殊字符替換
```

### 4. 容錯和恢復邏輯
```
異常檢測 
  ├─ 檔案操作失敗 → 跳過當前，繼續處理
  ├─ 重複檔名 → 自動添加序號（_01, _02）
  ├─ 特殊字符 → 自動清理和替換
  └─ 進度中斷 → 從上次中斷點恢復（基於追蹤檔案）
       ↓
    完整報告：成功數、失敗數、修復數、耗時
```

### 5. 使用者場景邏輯
```
場景 1：一次性命名（新用戶）
  流程：選擇資料夾 → 執行分析 → 自動命名 → 完成
  工具：GUI（最簡單）

場景 2：增量命名（新舊混合） ⭐ 推薦
  流程：檢測已命名 → 只命名未命名 → 節省資源
  工具：interactive_rename.sh（推薦日常）
  優勢：80% 加速、智能自動檢測

場景 3：重做命名（對舊命名不滿）
  流程：強制模式 → 重新分析所有 → 完整覆蓋
  工具：--force-rename 參數

場景 4：程式化集成（開發者）
  流程：Python API 調用 → 自訂命名規則 → 接收結果
  工具：full_batch_rename_execute.py（可作為模塊）
```

### 6. 文檔和通信邏輯
```
用戶層級         → 推薦文檔              → 預期來源

非技術用戶        → 使用指南.md           → 圖形化介面
                  → GUI 教學視頻

一般使用者        → v1.1_說明.md          → 故障排查
                  → README.md

開發者/貢獻者     → 項目結構說明.md       → 架構設計
                  → copilot-instructions  → 開發規範
```

---

## 📝 zh-TW 語言標準化規範

### MUST（必須遵守）
- ✅ 所有文本 MUST 使用台灣繁體中文（zh-TW）
- ✅ 用戶面向文檔 MUST 包含繁體中文（不含簡體字）
- ✅ 技術術語 MUST 使用統一的中文譯詞
- ✅ 代碼註解 MUST 使用繁體中文
- ✅ Commit 訊息 MUST 使用 zh-TW

### 術語統一對照表
| 英文 | zh-TW 標準 | ❌ 禁用 |
|------|-----------|--------|
| Repository | 儲存庫 | 倉庫 |
| Commit | 提交 | 承諾 |
| Branch | 分支 | - |
| Pull Request | 拉取請求 | 合併請求 |
| File | 檔案 | 文件（用於 document） |
| Folder | 資料夾 | 文件夾 |
| Image | 圖片 | 圖像 |
| Command Line | 命令行 | 命令列 |
| GUI | 圖形介面 | 視窗 |
| Vision Model | 視覺模型 | 圖像模型 |
| Tracking | 追蹤 | 跟蹤 |
| Deduplicate | 去重 | - |
| Incremental | 增量 | - |

### ShouldNot（應該避免）
- ❌ 混用繁簡體中文
- ❌ 英文術語不加說明就使用
- ❌ 模糊的中英混雜（如 "file 處理"）
- ❌ 使用簡體字（如：图、象、类、来、往、会等）

### 驗證檢查清單（Code Review）
```bash
# 檢查簡體字遺跡
grep -E '[图象么类来往会用做过叫说告以让这么个什到些很可想做已被数整面理上共及因来于后发]' \
  src/**/*.py docs/**/*.md .github/**/*.md

# 檢查 commit 訊息格式
git log --oneline -5

# 檢查文檔中文標點
grep -E '[,;?!]' docs/**/*.md  # 應該是繁體 ，。；：？！
```

---

## 🔄 與 AI 的協作循環

### 1. 明確指示（Clear Instructions）
給 AI 助手明確的指示，而非模糊的請求：
```
❌ "幫我重命名這些圖片"
✅ "使用 Qwen3-VL 分析圖片，優先提取圖片中的標題，
    自動處理重複，生成完整映射表，
    並驗證所有檔名的唯一性"
```

### 2. 反覆驗證（Iterative Verification）
不要盲目接受 AI 生成的結果：
```
1. AI 生成代碼
2. 人工檢查邏輯和實現
3. 運行測試和驗證
4. 根據結果調整和改進
5. 重複直到滿足標準
```

### 3. 記錄決策（Decision Documentation）
記錄 AI 建議和人工決策的對話：
```
- AI 建議什麼？
- 為什麼接受或拒絕？
- 最終選擇了什麼？
- 結果如何？
```

---

## 📚 參考資源

### GitHub Copilot 官方文檔
- [Copilot 使用指南](https://docs.github.com/en/copilot/using-github-copilot)
- [Copilot 最佳實踐](https://github.com/github/copilot-docs)

### 本項目文檔
- [ARCHITECTURE.md](docs/ARCHITECTURE.md) - 技術架構
- [FIRST_PRINCIPLES.md](docs/FIRST_PRINCIPLES.md) - 第一性原理分析
- [README.md](README.md) - 項目概述和使用指南

### 相關最佳實踐
- Clean Code - Robert C. Martin
- Software Architecture - The Hard Parts - Neal Ford et al.
- Prompt Engineering for AI - OpenAI Cookbook

---

## 🚀 與此項目的應用

### 本項目應用了以下原則
1. **真實性優先**：使用 Vision Model 直接分析圖片，而非模式匹配
2. **可復用性**：提供通用的分析腳本和配置模板
3. **容錯性**：進度保存、自動重試、詳細日誌
4. **透明性**：完整的映射表、分析結果、驗證報告

### 成果驗證
- ✅ 338 張圖片精準命名
- ✅ 97% 優先使用圖片標題
- ✅ 100 / 100 品質評分
- ✅ 0 個重複檔名
- ✅ 100% 驗收標準達成

---

## 🎨 GUI 設計規範（v1.2.3+）

### 核心設計理念：單頁、無滾動、最佳可用性

#### 1. 佈局結構

**目標**：一個畫面看到所有資訊，無需上下拉動

```
┌─────────────────────────────────────────────────────┐
│  📸 圖片智能命名系統              ⚙️ 執行選項       │
│  使用 Qwen3-VL 視覺分析         🔄 強制重新命名    │
│                                  🗑️ 刪除原檔案      │
├──────────────────┬──────────────────────────────────┤
│  📁 步驟 1         │  ⚠️ 警告訊息                     │
│  選擇資料夾       │                                │
│                  │  📊 執行進度                    │
│  🗂️ 瀏覽資料夾   │  [進度條] 100%                │
│  💡 提示          │  ETA: 計算中...                │
├──────────────────┤                                │
│  🚀 開始  🔄 清空 │                                │
│  ❌ 關閉           │                                │
├──────────────────┴──────────────────────────────────┤
│  📋 執行日誌                                        │
│  ✅ IMG_0001.JPG → 生活_家庭_兄妹與螃蟹.JPG      │
│  ✅ IMG_0002.JPG → 生活_親子_孩童玩樂.JPG        │
│  ...                                              │
└─────────────────────────────────────────────────────┘
```

**佈局比例**：
- 左側（主要內容）：80%
- 右側（選項面板）：20%
- 視窗寬度：1200px（固定）
- 視窗高度：800px（固定，無需調整大小）

#### 2. 色彩設計

**背景**：暗藍色 #1a3a52
- 目的：舒適長時間觀看，減少眼睛疲勞
- 符合 macOS Dark Mode 設計

**按鈕文字色**：深色 #1a1a1a（不是白色！）
- 原因：白色文字在彩色背景上可能看不清
- 深色文字確保高對比度和可讀性
- 紅色按鈕例外：使用白色文字（红色背景下白色清晰）

**標準色**：Apple 標準（HIG）
- 藍色 #007AFF：主要操作
- 紅色 #FF3B30：危險操作
- 綠色 #34C759：成功狀態
- 灰色 #8E8E93：次要文字

#### 3. 字體設計

**增大尺寸原則**（符合 macOS 人體工學）

| 用途 | 字體 | 舊版 | v1.2.3 | 增幅 |
|------|------|------|--------|------|
| 標題 | San Francisco | 28px | 32px | +14% |
| 副標題 | San Francisco | 16px | 20px | +25% |
| 標籤 | San Francisco | 14px | 16px | +14% |
| 按鈕 | San Francisco | 14px | 15px | +7% |
| 複選框 | San Francisco | 13px | 15px | +15% |
| 幫助文字 | San Francisco | 12px | 14px | +17% |
| 代碼/日誌 | Menlo | 12px | 13px | +8% |

**目的**：提高可讀性，符合 Apple 可達性標準（WCAG AA）

#### 4. 用戶交互流程

```
1️⃣ 用戶啟動 GUI
   ↓
2️⃣ 看到清晰的三段內容（單頁）
   - 左側：資料夾選擇、進度、按鈕、日誌
   - 右側：選項面板（強制重新命名、刪除原檔案）
   ↓
3️⃣ 選擇資料夾並配置選項
   ↓
4️⃣ 點擊「🚀 開始命名」
   ↓
5️⃣ 實時看到進度（進度條、百分比、ETA）
   ↓
6️⃣ 執行日誌實時更新
   ↓
7️⃣ 完成時 messagebox 通知
```

#### 5. 關鍵設計決策

| 決策 | 舊設計 | v1.2.3 | 理由 |
|------|--------|--------|------|
| 滾動條 | 有（Canvas + Scrollbar） | 無 | 單頁設計，所有內容一目瞭然 |
| 選項位置 | 居中（步驟 2） | 右上角 | 更有效利用空間，視覺清晰 |
| 按鈕文字色 | 白色 | 深色 #1a1a1a | 高對比度，易於閱讀 |
| 字體大小 | 小（12-14px） | 大（14-32px） | 符合 macOS 可達性標準 |
| 視窗尺寸 | 可調整（700-800px） | 固定（1200x800） | 確保最佳佈局，無需適配 |

#### 6. 無障礙設計

**鍵盤導航**：
- Tab 鍵可以在所有交互元素間移動
- Enter 鍵啟動按鈕
- Space 鍵勾選複選框

**螢幕閱讀器**：
- 所有標籤有明確的文字說明
- 進度條有百分比標籤
- 錯誤訊息清晰且有聲音提示

**高對比度**：
- 文字對背景對比度 ≥ 4.5:1（WCAG AA）
- 所有交互元素 ≥ 24x24px（觸控友善）

---

**每次完成任務後，MUST 執行 git commit。**

### Commit 訊息規範

```
<type>(<scope>): <簡短摘要>

## 意圖與情境
- 用戶想要達成什麼目標
- 在什麼背景下提出需求

## 執行內容
- 具體做了哪些修改
- 新增/修改/刪除了哪些檔案

## 決策理由
- 為什麼選擇這個方案
- 第一性原理分析結果

## 執行結果
- 達成了什麼效果
- 驗證結果（通過/失敗）

## 待確認工作
- 需要人類確認的事項
- 後續建議的行動
```

### Commit Type

| Type | 用途 |
|------|------|
| `feat` | 新功能 |
| `fix` | 錯誤修復 |
| `docs` | 文件更新 |
| `refactor` | 重構（不改變功能） |
| `test` | 測試相關 |
| `chore` | 雜項（設定、依賴等） |

### 語言要求

- Commit 訊息 MUST 使用繁體中文（zh-TW）
- 技術術語可保留英文（如 API、MCP、LLM）

---

## 🔧 Context7 MCP 使用規範（Non-Negotiable）

**所有技術決策 MUST 透過 Context7 MCP 取得最新官方文件。**

### 使用流程

```
1. 先呼叫 resolve-library-id 取得正確的 library ID
2. 再呼叫 context7-query-docs 取得文件
3. 基於官方文件做出技術決策
4. 在 commit 中記錄文件來源
```

### 實踐範例

**不好的做法：**
```
"我知道如何使用 Bash，直接寫腳本"
```

**好的做法：**
```
1. 呼叫 resolve-library-id 取得 /bminor/bash
2. 呼叫 context7-query-docs 查詢 "interactive CLI user input"
3. 基於官方文件最佳實踐編寫腳本
4. 在 commit 中記錄來源：
   "基於 Bash 官方文件 context7:/bminor/bash 的最佳實踐"
```

---



---

## 🎨 GUI 設計原則（v1.1.2+）

**目標**：為非技術人員提供友善的使用介面

### 設計理念
- **最小成本**：使用 Python 內置 tkinter，無額外依賴
- **輕量化**：界面簡潔，功能聚焦
- **清晰指引**：步驟明確，提示友善

### 核心功能
1. **資料夾選擇**：使用原生文件對話框
2. **功能選項**：複選框選擇 (強制重新命名、刪除原檔案)
3. **進度反饋**：實時顯示執行進度和結果
4. **錯誤處理**：清晰的錯誤提示和恢復建議

### 應用層次
- 主窗口：`ImageRenamerGUI` 類
- 子組件：資料夾選擇、選項設置、結果顯示
- 線程管理：後台執行命名，避免 GUI 凍結

### 啟動方式
```bash
bash scripts/gui.sh      # 推薦使用
python3 src/gui_selector.py  # 直接調用
```

